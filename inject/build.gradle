import org.anarres.gradle.plugin.jarjar.JarjarTask
includePublication = false
dependencies {
    compile project(":core")
    compile group: 'javax.inject', name: 'javax.inject', version: '1'

    compileOnly "org.codehaus.groovy:groovy:$groovyVersion"
    compileOnly 'org.ow2.asm:asm:5.2'
    compileOnly 'org.ow2.asm:asm-commons:5.2'
    ['javax.validation:validation-api:1.1.0.Final',
     'org.yaml:snakeyaml:1.18'].each { String dep ->
        compileOnly dep
        testCompile dep
    }

}



def targetDir = new File(project.buildDir, "jarjar")
def targetFile = new File(targetDir, "asm.jar")
def jarjarTask = task("jarjarTask", type: JarjarTask) {
    from(project.files(jar.archivePath))
    classRename "org.objectweb.asm.**", "org.particleframework.asm.@1"
    destinationDir = targetDir
    destinationName = targetFile.name
}
jarjarTask.dependsOn(jar)

def jarjarOutputs = task("jarjarOutputs").doLast {
    copy {
        from zipTree(jarjarTask.destinationPath)
        into(targetDir)
    }
    delete(jarjarTask.destinationPath)
}
jarjarOutputs.dependsOn(jarjarTask)
task("rejar", type:Jar, dependsOn: jarjarOutputs) {
    from(targetDir)
    archiveName = "rejar.jar"
}
